<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multi‐Zone Layout with Børneloppen TV & Vejr</title>
  <link rel="stylesheet" href="Content/style.css" />
  <style>
    /* Using ticker CSS from previous working version */
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      display: grid;
      grid-template-columns: 300px 1fr;
      grid-template-rows: 1fr 100px;
      overflow: hidden;
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
    }
    #weather-zone { grid-column: 1/2; grid-row: 1/3; background: #222; }
    #main-zone { grid-column: 2/3; grid-row: 1/2; background: #333; display: flex; align-items: center; justify-content: center; }
    #news-zone {
      grid-column: 2/3;
      grid-row: 2/3;
      background: #111;
      overflow: hidden;
      white-space: nowrap;
      font-size: 1.2rem;
      line-height: 100px;
      padding-left: 10px;
    }
    @keyframes ticker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    .ticker-text {
      display: inline-block;
      padding-right: 100%;
      animation: ticker 30s linear infinite;
    }
  </style>
</head>
<body>
  <!-- Left: Weather “Vejr” (Copenhagen) -->
  <div id="weather-zone">
    <!-- Replaced URL due to DNS issue ("IP-adressen … blev ikke fundet") -->
    <iframe
      src="https://via.placeholder.com/300x600?text=Weather+Unavailable"
      style="border: none; width: 100%; height: 100%;"
      allowtransparency="true">
    </iframe>
    <!-- New Weather Widget added at the top -->
    <iframe src="https://api.wo-cloud.com/content/widget/?geoObjectKey=2301384&language=da&region=DK&timeFormat=HH:mm&windUnit=mps&systemOfMeasurement=metric&temperatureUnit=celsius" 
      name="CW2" scrolling="no" width="290" height="318" frameborder="0" style="border: 1px solid #FFFFFF; border-radius: 14px">
    </iframe>
    <div style="background:#fff; height:2px;"></div>
    <!-- Added sidebar element -->
    <pr-weather-and-stocks id="pr-weather-app" style="width:440px; height:990px" class="ng-isolate-scope">
      <!-- ...existing pr-weather-and-stocks content... -->
      <div id="left-column" layout="column" ng-style="columnStyle" ng-if="!isMulti" class="ng-scope layout-column" style="background-image: linear-gradient(36deg, rgb(223, 30, 98) 0%, rgb(223, 30, 98) 100%); color: white;">
        <!-- ...existing content from provided snippet... -->
        <div layout="column" layout-align="start center" class="layout-align-start-center layout-column">
          <div ng-class="enable12HourClock ? 'time-a' : 'time'" class="ng-binding time">20:13</div>
          <div class="date capitalize-first-letter ng-binding">tirsdag d. 03 jun. 2025</div>
        </div>
        <div class="heading ng-binding">Vejret i dag (Horsens)</div>
        <hr style="border-top: 1px solid white; height: 1px;">
        <div layout="row" layout-align="space-between center" class="layout-align-space-between-center layout-row">
          <i class="pe-5x pe-is-w-mostly-cloudy-2"></i>
          <div layout="column" layout-align="center end" class="layout-align-center-end layout-column">
            <div class="current-temperature ng-binding">19°C</div>
            <div class="current-weather-description capitalize-first-letter ng-binding">skydække</div>
          </div>
        </div>
        <hr style="border-top: 1px solid white; height: 1px;">
        <!-- Repeated forecast rows … -->
        <!-- ... -->
        <div layout="row" layout-align="center center" class="layout-align-center-center layout-row">
          <img class="logo" src="https://content.evosignage.com/news-page-logo/5f5ba51065134a8c8f095b231b0bb08c.png">
        </div>
        <!-- Fallback content if data is missing -->
        <div class="fallback" style="text-align:center; color: white; margin-top:10px;">
          Loading Weather and Stocks...
        </div>
      </div>
    </pr-weather-and-stocks>
  </div>

  <!-- Main: Børneloppen TV Embed with counters -->
  <div id="main-zone">
    <iframe
      src="https://www.boerneloppen.dk/tv?showCounters=true"
      style="border: none; width: 100%; height: 100%;"
      sandbox="allow-scripts allow-same-origin allow-popups"
      allowfullscreen>
    </iframe>
  </div>

  <!-- Bottom: Scrolling News Ticker (RSS) -->
  <div id="news-zone">
    <div class="ticker-text" id="ticker"></div>
  </div>
  <!-- Inline ticker script using BBC feed -->
  <script>
    async function loadNewsTicker() {
      const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
      // Updated RSS URL to use https
      const RSS_URL = 'https://feeds.bbci.co.uk/news/world/rss.xml';
      try {
        const response = await fetch(CORS_PROXY + encodeURIComponent(RSS_URL));
        const xmlText = await response.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, 'application/xml');
        const items = Array.from(xml.querySelectorAll('item > title')).slice(0, 10);
        const headlines = items.map(el => el.textContent);
        document.getElementById('ticker').textContent = headlines.join('  •  ');
      } catch (e) {
        document.getElementById('ticker').textContent = 'Unable to load news feed.';
        console.error(e);
      }
    }
    loadNewsTicker();
    setInterval(loadNewsTicker, 600000); // refresh every 10 minutes
  </script>
  <!-- New: Script to listen for video end event and change screen -->
  <script>
    window.addEventListener("message", function(e) {
      if (e.data === "videoEnded") {
        window.location.reload();
      }
    });
  </script>
</body>
</html>
